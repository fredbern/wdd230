<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Fetch Testing</title>
</head>
<body>

    <div class="cards"></div>
    
<script>
    const requestURL = 'https://byui-cit230.github.io/weather/data/towndata.json';
    fetch(requestURL)
    .then(function (response) {
        return response.json();
    })
    .then(function (jsonObject){
        console.table(jsonObject);
        const towns = jsonObject['towns'];
        
        towns.forEach((towns, index, array) => {

            const townName = `Name: ${array[index].name}`;
            const motto = `motto: ${array[index].motto}`;
            const yFound = `Year Found: ${array[index].yearFounded} `;

            console.log(townName);
            let card = document.createElement('section');
            let h2 = document.createElement('h2');
            h2.innerText = townName;
            let p1 = document.createElement('p');
            p1.innerText = motto;
            let yearFound = document.createElement('p');
            yearFound.innerText = yFound;        
            let image = document.createElement('img');
            image.setAttribute('data-src', array[index].imageurl);
            image.setAttribute('src', 'images/placeholder.jpg');
            image.setAttribute('alt', array[index].name);
        
            card.appendChild(h2);
            card.appendChild(p1);
            card.appendChild(yearFound);
            document.querySelector('div.cards').appendChild(card);
        
        });

        const imagesToLoad = document.querySelectorAll('img[data-src]');

const loadImages = (image) => {
    image.setAttribute('src', image.getAttribute('data-src'));
    image.onload = () => {
        image.removeAttribute('data-src');
    };
};

const imgOptions = {
    threshold: 1
};
//if this is true
if ('IntersectionObserver' in window) {
    // is supported so let's go!!!
    const imgObserver = new IntersectionObserver((items) => {
        items.forEach((item) => {
            if (item.isIntersecting) {
                loadImages(item.target);
                imgObserver.unobserve(item.target);
            }
        });
    }, imgOptions);

    // load image if necessary
    imagesToLoad.forEach((img) => {
        imgObserver.observe(img);
    });
} else { //just load all images if not supported
    imagesToLoad.forEach( (img) => {
        loadImages(img);
    });
}
    });
    
</script>
</body>
</html>